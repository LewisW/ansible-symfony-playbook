---
- name: Check for ACLs
  shell: hash getfacl
  register: acl_check
  tags:
    - shared_directories

- name: Enable permission to app folders
  file: path={{item}} mode=2775 recurse=yes state=directory owner={{ansible_ssh_user}} group={{http_user}}
  when: "acl_check.rc == 1"
  with_items: shared_directories
  tags:
    - shared_directories

- name: Make sure the app folders exist
  file: path={{item}} state=directory
  when: "acl_check.rc == 0"
  with_items: shared_directories
  tags:
    - shared_directories

- name: Enable permission to app folders for apache
  acl: name={{item}} entity={{http_user}} etype=user permissions=rwx state=present
  sudo: yes
  when: "acl_check.rc == 0"
  with_items: shared_directories
  tags:
    - shared_directories

- name: Enable permission to app folders for ansible user
  acl: name={{item}} entity={{ansible_ssh_user}} etype=user permissions=rwx state=present
  sudo: yes
  when: "acl_check.rc == 0"
  with_items: shared_directories
  tags:
    - shared_directories

- name: Enable default permission to app folders for apache
  acl: name={{item}} entity={{http_user}} etype=user permissions=rwx default=yes state=present
  sudo: yes
  when: "acl_check.rc == 0"
  with_items: shared_directories
  tags:
    - shared_directories

- name: Enable default permission to app folders for ansible user
  acl: name={{item}} entity={{ansible_ssh_user}} etype=user permissions=rwx default=yes state=present
  sudo: yes
  when: "acl_check.rc == 0"
  with_items: shared_directories
  tags:
    - shared_directories
